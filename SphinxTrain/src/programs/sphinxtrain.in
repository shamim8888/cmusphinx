#!/usr/bin/python

sphinxpath="@prefix@"

import getopt, sys, os

def setup(task):
    print "Setting up the database " + task
    os.system(sphinxpath + 
              "/lib/sphinxtrain/scripts_pl/setup_SphinxTrain.pl -task '" + 
              task + 
              "' -sphinxtraindir '" + 
              sphinxpath + 
              "/lib/sphinxtrain' ");

def run():
    print "Running the training"
    os.system(sphinxpath + "/lib/sphinxtrain/scripts_pl/RunAll.pl")

def usage():
    print "Usage: sphinxtrain [options] <command>"
    print ""
    print "Commands:"
    print "     -t <task> setup - copy configuration into database"
    print "     run - run the training"

def main():

    try:
        opts, args = getopt.getopt(sys.argv[1:], "ht:", ["help", "task"])
    except getopt.GetoptError, err:
        print str(err)
        usage()
        sys.exit(-1)
        
    task = None
        
    for o, a in opts:
	if o in ("-t", "--task"):
	    task = a
	if o in ("-h", "--help"):
    	    usage()
    
    if len(args) == 0:
	usage()
	sys.exit(-1)
    
    command = args[0]
    
    if command == "setup":
	if task == None:
	    print "No task name defined"
	    sys.exit(-1)	
	setup(task)
    if command == "run":
	run()
    	    
if __name__ == "__main__":
    main()
